<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:context="http://www.springframework.org/schema/context"
	xmlns:mvc="http://www.springframework.org/schema/mvc" xmlns:p="http://www.springframework.org/schema/p"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/beans   
    http://www.springframework.org/schema/beans/spring-beans-4.0.xsd  
    http://www.springframework.org/schema/context  
    http://www.springframework.org/schema/context/spring-context.xsd  
    http://www.springframework.org/schema/mvc   
    http://www.springframework.org/schema/mvc/spring-mvc-4.0.xsd">
	<!-- 加载包中的controller 注解扫描包 -->
	<context:component-scan base-package="com.kjyl.controller" />
	<!-- 开启注解 -->
	<bean class="org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter" />
	<bean class="org.springframework.web.servlet.mvc.annotation.DefaultAnnotationHandlerMapping" />
	<!-- 静态资源的访问 --> 
    <mvc:resources location="/pages/" mapping="/pages/**"/>
	 <!--拦截器配置-->
     <mvc:interceptors>
        <mvc:interceptor>
            <mvc:mapping path="/**"/>
            <bean id="authenticationInterceptor" class="com.kjyl.controller.AuthenticationController">
                <property name="passList"><!--静态资源不拦截--><!-- 跳过token验证(适用于游客和用户查看资源) -->
                    <list>
                     	<value>/Error/Interface/Unknown</value>
                        <value>/Error/Interface/Parameter</value>
                        <value>/Error/Interface/Authorized</value>
                        <value>/Error/Interface/JsonError</value>
                        <value>/Error/Interface/UserNoExist</value>
                        <value>/Error/Interface/UnknownV2</value>
                        <value>/Error/Interface/ParameterV2</value>
                        <value>/Error/Interface/AuthorizedV2</value>
                        <value>/Error/Interface/JsonErrorV2</value>
                        <value>/Error/Interface/UserNoExistV2</value>
                        
                        <value>/user/active</value>
                        <value>/user/verify</value>
                        <value>/user/signin</value>
                        <value>/user/wechat</value>
                    </list>
                </property>
                <property name="whiteList"><!--动态资源白名单--><!--  -->
                    <list>
                        <!-- <value>/user/active</value> -->
                        <!-- <value>/user/verify</value> -->
                        <value>/user/verifycode</value><!-- 测试Demo -->
               			<!-- <value>/user/updatename</value>
               			<value>/user/updatesex</value>
               			<value>/user/updatebirth</value>
               			<value>/user/updatephone</value>
              			<value>/user/updatepaypass</value> -->
                        <!-- <value>/user/wechat</value> -->
                        <value>/user/logout</value>
              			<!-- <value>/user/updateheadicon</value>
                        <value>/user/userinfo</value> -->
                        <value>/user/usergame</value>
                        <value>/user/userread</value>
                        <value>/user/useractivity</value>
                        <value>/users/login</value>
                        <!-- <value>/user/addsign</value> -->
                        <value>/user/signlist</value>
                        <!-- <value>/user/signin</value> -->
                        <!-- <value>/user/modifypassword</value> -->
                        <value>/user/Interface/V2/AccountLogin</value>
                        
                        <value>/video/addvideo</value>
                        <value>/video/videolist</value>
                        <value>/video/getreward</value>
                        <value>/video/myvideo</value>
                        <value>/video/addclick</value>
                        <value>/video/videodetail</value>
                        <!-- <value>/video/likeclick</value> -->
                        <value>/video/videocomments</value>
                        <value>/video/addcomment</value>
                        
                        <value>/activity/activitylist</value>
                        <value>/activity/activitydetail</value>
                        
                        <value>/rankings/toprankings</value>
                        <value>/rankings/rankings</value>
                        
                        <value>/book/booklist</value>
                        <value>/book/bookdetail</value>
                        <value>/book/bookcomments</value>
                        <value>/book/addcomment</value>
                        
                        <value>/forum/forumlist</value>
                        <!-- <value>/forum/myforum</value>                        
         			    <value>/forum/addforum</value>
          				<value>/forum/addpraise</value> -->
          				<value>/forum/uploadforum</value>
         			    <value>/forum/delforum</value>
           				<value>/forum/forumcomment</value>
           				<value>/forum/showcomment</value>
           				<value>/forum/uploadpics</value>
           				<value>/forum/showmore</value>
           				<value>/forum/forumshowmore</value>
           				<value>/forum/forumdetail</value>
           
           				<value>/mall/shoppingcart</value>
                        <!-- <value>/mall/shopaddress</value>
                        <value>/mall/addaddress</value> -->
                        <value>/mall/deladdress</value>
                        <value>/mall/modifyaddress</value>
                        <value>/mall/delshop</value>
                        <!-- <value>/mall/addshopcar</value>
                        <value>/mall/shopcarlist</value>
                        <value>/mall/orderlist</value> -->
                        <value>/mall/deleteorder</value>
                       <!--  <value>/mall/setdefault</value> -->
                        
                       <!--  <value>/pay/paymessage</value> -->
                        <value>/pay/buygoldcoin</value>
                        <!-- <value>/pay/actjoin</value>
                        <value>/pay/payvideo</value>
                        <value>/pay/confirmpay</value>
                        <value>/pay/payshop</value>
                        <value>/pay/confirmpwd</value>
                        <value>/pay/confirm</value>
                       	<value>/pay/conversion</value> -->
                       	<value>/pay/Interface/V1/reward</value>
                        
                        <!-- <value>/message/opinion</value>
                        <value>/message/appmessage</value> -->
                        <value>/message/appversion</value>
                        <value>/message/banner</value>
                        <value>/message/Interface/V2/PictureType</value>
                        <value>/message/regions</value>
                        <value>/message/comments</value>
                        <value>/message/addcomment</value>
                        <value>/message/share</value>
                        <!-- <value>/message/readmessage</value>
                        <value>/message/readweek</value>
                        <value>/message/readmore</value>
                        <value>/message/allread</value>
                        <value>/message/readpoint</value>
                        <value>/message/integral</value> 
                        <value>/message/measurelevel</value>-->
                        <value>/message/joingame</value>
                        <value>/message/regions</value>
                        <value>/message/Interface/V1/Regions</value>
                        <value>/message/Interface/V1/getreward</value>
                        <value>/message/Interface/V2/SearchRegion</value>
                        <value>/message/Interface/V2/BookRecommend</value>
                        
                        <!-- DemoUrl -->
                        <value>/message/abc</value>
                        
                        <value>/back/embody</value>
                        <value>/back/payCallBack</value>
                        
                        <!-- V2 interface -->
                        <value>/user/Interface/V2/examinePseudonym</value>
 	              		<value>/user/Interface/V2/signIn</value>
 	          <value>/user/Interface/V2/changeLoginPassword</value>
 	          			<value>/user/Interface/V2/WeChat</value>
 	          			<value>/user/Interface/V2/verify</value>
 	          			<value>/user/Interface/V2/active</value>
 	          			<value>/user/Interface/V2/ExamineAccount</value>
 	          			<value>/user/Interface/V2.1/active</value>
 	          			<value>/user/Interface/V2.1/verify</value>
 	          			<value>/user/Interface/V2/Authorization</value>
 	          			
 	          <!-- <value>/user/Interface/V2/AddPlan</value>
 	          <value>/user/Interface/V2/AddJournal</value> -->
 	          <value>/message/Interface/V2/ShowJournal</value>
 	          <value>/message/Interface/V2/ShowPlan</value>
 	          <value>/rankings/Interface/V2/Rankings</value>
 	          <value>/message/Interface/V2/ChooseBranch</value>
 	          <value>/Department/Interface/V2/SaveReadDetail</value>
 	          <value>/Department/Interface/V2/MemberList</value>
 	          			<value>/user/Interface/V2/Choose</value>
 	          			<value>/user/Interface/V2/verifycode</value>
 	          			<value>/user/Interface/V2/SetPassword</value>
 	          			<value>/Read/Interface/V2/ReadSaveRecord</value>
 	          			<value>/problem/problemlist</value>
 	          			<value>/problem/addProblemGrade</value>
 	          			<!-- <value>/video/Interface/V2/TeacherVideo</value> -->
 	          			
 	          			<!-- V3 -->
 	          			<value>/News/Interface/V3/SearchNews</value>
 	          			<value>/Information/Interface/V3/SearchInformations</value>
 	          			<value>/Voice/Interface/V3/SearchVoices</value>
 	          			<value>/Read/Interface/V2/ReadSaveMessage</value>
 	          			
 	          			<value>/Message/Interface/V3/Detection</value><value>/message/Interface/V3/Detection</value>
 	          			
 	          			
                    </list>
                </property>
                <property name="backWhiteList"><!--动态资源白名单 后台-->
                    <list>
                     <value>/users/index</value>
                     <value>/users/rank</value>
                     <value>/users/userinfo</value>
                     <value>/users/ranklist</value>
                     <value>/users/readlist</value>
                     <!-- <value>/activity/activitylist</value>
                     <value>/activity/activitydetail</value> -->
                     <!-- <value>/forum/forumlist</value>
           <value>/forum/addforum</value>
           <value>/forum/addpraise</value> -->
                     
                    </list>
                </property>
            </bean>
        </mvc:interceptor>
    </mvc:interceptors>
    <!-- 新增 -->
<mvc:default-servlet-handler/>


	<!-- 视图分解器 -->
	<bean id="viewResolver" class="org.springframework.web.servlet.view.InternalResourceViewResolver">
		<property name="prefix" value="/pages/" />
		<property name="suffix" value=".jsp" />
	</bean>	
	<!-- 启用默认配置 -->
    <mvc:annotation-driven>
        <mvc:message-converters register-defaults="true">
            <!-- 配置Fastjson支持 -->
            <bean class="com.alibaba.fastjson.support.spring.FastJsonHttpMessageConverter">
                <property name="supportedMediaTypes">
                    <list>
                        <value>text/html;charset=UTF-8</value>
                        <value>application/json</value>
                    </list>
                </property>
                <property name="features">
                    <list>
                        <value>WriteMapNullValue</value>
                        <value>QuoteFieldNames</value>
                        <value>WriteNullListAsEmpty</value>
                        <value>WriteNullBooleanAsFalse</value>
                        <value>WriteDateUseDateFormat</value>
                    </list>
                </property>
            </bean>
        </mvc:message-converters>
    </mvc:annotation-driven>
	
	<!-- 上传文件的解析器  -->
	<bean id="multipartResolver" class="org.springframework.web.multipart.commons.CommonsMultipartResolver"> 
		<property name="defaultEncoding" value="utf-8"/>
		<property name="maxUploadSize" value="10485760000"/> 
		<property name="maxInMemorySize" value="40960"/> 
	</bean> 

</beans> 